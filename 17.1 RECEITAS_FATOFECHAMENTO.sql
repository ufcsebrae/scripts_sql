USE HUBDADOS;

DECLARE @LISTA TABLE(CONTA VARCHAR(MAX))
DECLARE @ANO INT = 2025
DECLARE @MES INT = 8

INSERT INTO @LISTA
VALUES 
('4.1.1.1.01.001'),
('4.1.1.1.01.002'),
('4.1.1.1.01.003'),
('4.1.1.1.01.004'),
('4.1.1.1.01.005'),
('4.1.1.1.01.006'),
('4.1.1.1.01.999'),
('4.1.1.1.02.001'),
('4.1.1.2.01.001'),
('4.1.1.2.01.002'),
('4.1.3.1.01.001'),
('4.1.2.1.01.001'),
('4.1.2.1.01.002'),
('4.1.2.1.01.003'),
('4.1.2.1.01.004'),
('4.1.2.1.01.005'),
('4.1.2.1.01.006'),
('4.1.2.1.01.007'),
('4.1.2.1.01.008'),
('4.1.2.1.01.009'),
('4.1.2.1.01.010'),
('4.1.2.1.01.011'),
('4.1.2.1.01.012'),
('4.1.2.1.01.013'),
('4.1.2.1.01.014'),
('4.1.2.1.01.998'),
('4.1.2.1.01.999'),
('4.1.4.1.01.001'),
('4.1.4.6.01.001'),
('4.1.4.6.01.002'),
('4.1.4.6.01.003'),
('4.1.4.6.01.004'),
('4.1.4.6.01.005'),
('4.1.4.6.01.006'),
('4.1.3.2.01.001'),
('4.1.3.2.02.001'),
('4.1.1.6.01.001'),
('4.1.1.6.01.002'),
('4.1.5.3.01.001'),
('4.1.5.3.01.002'),
('4.1.5.3.01.007'),
('4.1.5.3.01.008'),
('4.1.5.3.01.999'),
('6.2.2.1.01.001'),
('6.2.4.1.01.001'),
('4.1.5.1.01.003')
;

WITH DEB_CRED AS (
    SELECT 
        A.DEBITO AS CONTA, 
		A.LCTREF,
        B.DESCRICAO, 
		A.DATA,
		A.IDLANCAMENTO, 
		A.COMPLEMENTO,
		A.CODFILIAL,
		A.CODLOTE,
		TIPO = 'D',
        CASE WHEN B.NATUREZA = '0' THEN A.VALOR * -1 ELSE A.VALOR END AS VALOR
    FROM CorporeRM.CLANCA A
    INNER JOIN CorporeRM.CCONTA B ON A.DEBITO = B.CODCONTA
    INNER JOIN @LISTA C ON A.DEBITO COLLATE SQL_Latin1_General_CP1_CI_AS = C.CONTA
    WHERE YEAR(A.DATA) = @ANO AND MONTH(A.DATA) = @MES AND A.CODHISTP <> '27'

    UNION ALL

    SELECT 
        A.CREDITO AS CONTA, 
		A.LCTREF,
        B.DESCRICAO,
		A.DATA,
		A.IDLANCAMENTO,
		A.COMPLEMENTO,
		A.CODFILIAL,
		A.CODLOTE,
		TIPO = 'C',
        CASE WHEN B.NATUREZA = '0' THEN A.VALOR ELSE A.VALOR * -1 END AS VALOR
    FROM CorporeRM.CLANCA A
    INNER JOIN CorporeRM.CCONTA B ON A.CREDITO = B.CODCONTA
    INNER JOIN @LISTA C ON A.CREDITO COLLATE SQL_Latin1_General_CP1_CI_AS = C.CONTA
    WHERE YEAR(A.DATA) = @ANO AND MONTH(A.DATA) = @MES AND A.CODHISTP <> '27'
)

SELECT 
    CONTA,
    FORMAT(VALOR, 'C', 'PT-BR') AS VALOR,
	LCTREF,
	IDLANCAMENTO,
	COMPLEMENTO,
	CODFILIAL,
	CODLOTE,
	TIPO,
	DATA,
	CASE WHEN CONTA IN ('4.1.1.1.01.001','4.1.1.1.01.002','4.1.1.1.01.003','4.1.1.1.01.004','4.1.1.1.01.005','4.1.1.1.01.006','4.1.1.1.01.999','4.1.1.1.02.001') THEN '6.1.1.1' 
	WHEN CONTA IN ('4.1.1.2.01.001', '4.1.1.2.01.002') THEN '6.1.2.1'
	WHEN CONTA IN ('4.1.3.1.01.001') THEN '6.2.1.1'
	WHEN CONTA IN ('4.1.2.1.01.001','4.1.2.1.01.002','4.1.2.1.01.003','4.1.2.1.01.004','4.1.2.1.01.005','4.1.2.1.01.006','4.1.2.1.01.007','4.1.2.1.01.008','4.1.2.1.01.009','4.1.2.1.01.010','4.1.2.1.01.011','4.1.2.1.01.012','4.1.2.1.01.013','4.1.2.1.01.014','4.1.2.1.01.998','4.1.2.1.01.999') THEN '6.2.1.2'
	WHEN CONTA IN ('4.1.1.1.01.001','4.1.1.1.01.002','4.1.1.1.01.003','4.1.1.1.01.004','4.1.1.1.01.005','4.1.1.1.01.006','4.1.1.1.01.999','4.1.1.1.02.001') THEN '6.1.1.1'
	WHEN CONTA IN ('4.1.4.1.01.001','4.1.4.6.01.001','4.1.4.6.01.002','4.1.4.6.01.003','4.1.4.6.01.004','4.1.4.6.01.005','4.1.4.6.01.006') THEN '6.2.1.3'
	WHEN CONTA IN ('4.1.5.3.01.001','4.1.5.3.01.002','4.1.5.3.01.007','4.1.5.3.01.008','4.1.5.3.01.999','6.2.2.1.01.001','6.2.4.1.01.001') THEN '6.2.1.4'
	WHEN CONTA IN ('4.1.3.2.01.001','4.1.3.2.02.001') THEN '6.1.3.2'
	WHEN CONTA IN ('4.1.1.6.01.001','4.1.1.6.01.002') THEN '6.1.2.3'
	ELSE NULL END 'NACIONAL'

FROM DEB_CRED


/*SELECT CODCONTA, DESCRICAO, NATUREZA, INATIVA FROM CORPORERM.CCONTA
WHERE CODCONTA LIKE '%4.1.3.2%'

SELECT CODCONTA, DESCRICAO, NATUREZA, INATIVA FROM CORPORERM.CCONTA
WHERE CODCONTA LIKE '4%' AND LEN(CODCONTA) = 7 AND INATIVA = '0'
ORDER BY DESCRICAO ASC*/