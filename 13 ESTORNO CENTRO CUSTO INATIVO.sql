DECLARE @CENTROCUSTO table (CC VARCHAR(255))
 
INSERT INTO @CENTROCUSTO VALUES
('01126.000002.025') -- ADM
,('05287.000015.280') -- VALE DO RIBEIRA GESTÃO
,('05287.000016.280') -- VALE DO RIBEIRA
,('05356.000005.276') -- ATRAÇÃO
,('05274.000017.258') -- RIBEIRÃO PRETO
,('05285.000016.243') -- SUDOESTE PAULISTA
,('05305.000021.016') -- INOVA OLHAR
,('05282.000012.262') -- CREDENCIAMENTO
,('02616.000002.025') -- SUPORTE ADM
,('05359.000007.019') -- FE 2023
,('05273.000010.250') -- GERAÇÃO DE NEGOCIOS ER OSASCO
,('05282.000016.262') -- GM SJC
,('04600.000002.279') -- GO TI
;
with RATEIO as (SELECT * FROM  [HubDados].[CorporeRM].[TITMMOVRATCCU] WITH (NOLOCK) WHERE CODCCUSTO COLLATE Latin1_General_CI_AS in (select CC from @CENTROCUSTO))
,TMOV AS (SELECT * FROM [HubDados].[CorporeRM].[TMOV] WITH (NOLOCK) WHERE [STATUS] <> 'C' AND [DATAMOVIMENTO] BETWEEN DATEADD(DAY, -30, GETDATE()) AND GETDATE() AND CODTMV NOT LIKE '4.1%')
,CC AS (SELECT * FROM [FINANCA].[dbo].[CENTROCUSTO_DESCRICAO] WITH (NOLOCK))
,DESC_MOV AS (SELECT * FROM [FINANCA].[dbo].[descricao_CODTMV] WITH (NOLOCK))
,TVEN AS (SELECT * FROM [HubDados].[CorporeRM].[TVEN] WITH (NOLOCK))
,FORNECEDOR AS (SELECT * FROM HubDados.CorporeRM.FCFO)
 
SELECT
FORMAT(A.DATACRIACAO,'d','pt-br') AS 'CRIADO EM'
,E.NOME AS 'VEN'
,B.CODCCUSTO
,C.PROJETO
,C.ACAO
,A.Historico
,A.CODTMV
,D.DESCMOV
,A.CODUSUARIO
,FORMAT(A.VALORBRUTO,'c','pt-br') AS 'BRUTO'
,CAMPOLIVRE1 AS 'CONTRATO'
,F.NOME AS 'VEN2'
,G.NOME AS 'VEN3'
,H.NOME AS 'VEN4'
,A.IDMOV
,I.NOME
,I.NOMEFANTASIA
,I.CODCFO
,I.CGCCFO
,A.NUMEROMOV AS 'NOTA FISCAL'
FROM TMOV A WITH (NOLOCK)
LEFT JOIN RATEIO B ON A.IDMOV = B.IDMOV
INNER JOIN CC C ON B.CODCCUSTO COLLATE Latin1_General_CI_AS = C.CENTROCUSTO
LEFT JOIN DESC_MOV D ON A.CODTMV = D.CODTMV
LEFT JOIN TVEN E ON A.CODVEN1 = E.CODVEN
LEFT JOIN TVEN F ON A.CODVEN2 = F.CODVEN
LEFT JOIN TVEN G ON A.CODVEN3 = G.CODVEN
LEFT JOIN TVEN H ON A.CODVEN4 = H.CODVEN
LEFT JOIN FORNECEDOR I ON A.CODCFO = I.CODCFO
ORDER BY A.DATACRIACAO DESC