USE HUBDADOS;

DECLARE @LISTA TABLE(CONTA VARCHAR(MAX))
DECLARE @ANO INT = '2022'
DECLARE @MES INT = '12'

INSERT INTO @LISTA
VALUES ('3.1.1.1.01.001'),
('3.1.1.1.01.002'),
('3.1.1.1.01.004'),
('3.1.1.1.01.005'),
('3.1.1.1.01.008'),
('3.1.2.1.04.004'),
('3.1.1.1.02.001'),
('3.1.1.2.01.002'),
('3.1.1.2.01.003'),
('3.1.1.2.01.008'),
('3.1.1.2.01.009'),
('3.1.4.1.01.007'),
('5.2.2.2.01.009'),
('5.2.3.1.01.006'),
('3.1.3.7.02.005'),
('3.1.3.1.02.004'),
('3.1.3.3.01.004'),
('5.2.2.1.01.003'),
('3.1.2.2.02.003'),
('3.1.3.7.01.012'),
('3.1.3.4.01.001'),
('3.1.4.2.01.002'),
('3.1.1.1.03.001'),
('3.1.4.1.01.002'),
('3.1.1.1.04.001'),
('3.1.1.2.01.004'),
('3.1.1.2.01.005'),
('5.2.3.1.01.005'),
('3.1.1.2.01.006'),
('3.1.1.3.01.001'),
('3.1.4.1.01.001'),
('3.1.4.2.01.999'),
('3.1.1.3.01.002'),
('3.1.1.3.01.003'),
('3.1.1.3.01.004'),
('3.1.1.3.01.005'),
('3.1.1.3.01.008'),
('3.1.1.3.01.999'),
('3.1.2.1.01.001'),
('3.1.2.1.01.002'),
('3.1.2.1.02.001'),
('3.1.2.1.02.002'),
('3.1.2.1.02.003'),
('3.1.2.1.02.004'),
('3.1.2.1.02.005'),
('3.1.2.1.02.007'),
('3.1.2.1.02.008'),
('3.1.2.1.02.009'),
('3.1.2.1.02.010'),
('3.1.2.1.02.013'),
('3.1.2.1.02.014'),
('3.1.2.1.02.019'),
('3.1.1.1.04.999'),
('3.1.2.1.02.022'),
('3.1.2.1.02.999'),
('3.1.2.1.03.001'),
('3.1.2.2.01.001'),
('3.1.2.2.01.002'),
('3.1.2.2.01.004'),
('3.1.2.2.01.005'),
('3.1.2.2.01.006'),
('3.1.2.2.01.008'),
('3.1.2.2.01.999'),
('3.1.2.2.02.001'),
('3.1.2.2.02.002'),
('3.1.2.2.02.004'),
('3.1.2.2.02.007'),
('3.1.2.2.02.999'),
('3.1.2.3.01.001'),
('3.1.3.1.01.001'),
('3.1.3.1.01.002'),
('3.1.3.1.01.003'),
('3.1.3.1.01.004'),
('3.1.3.1.01.005'),
('3.1.3.1.01.006'),
('3.1.3.1.01.999'),
('3.1.3.1.02.001'),
('3.1.3.1.02.002'),
('3.1.3.1.02.003'),
('3.1.3.1.02.005'),
('3.1.3.1.02.006'),
('3.1.3.1.02.009'),
('3.1.3.1.02.999'),
('3.1.3.2.01.001'),
('3.1.3.2.01.002'),
('3.1.3.2.01.003'),
('3.1.3.2.01.004'),
('3.1.3.2.01.999'),
('3.1.3.2.02.004'),
('3.1.3.3.01.001'),
('3.1.3.3.01.002'),
('3.1.3.3.01.003'),
('3.1.3.3.01.005'),
('3.1.3.3.01.007'),
('3.1.3.3.01.008'),
('3.1.3.4.01.002'),
('3.1.3.4.01.003'),
('3.1.3.4.01.005'),
('3.1.3.4.01.999'),
('3.1.3.5.01.003'),
('3.1.3.5.01.004'),
('3.1.3.5.01.005'),
('3.1.3.6.01.001'),
('3.1.3.6.01.002'),
('3.1.3.6.01.003'),
('3.1.3.6.01.004'),
('3.1.3.6.01.005'),
('3.1.3.6.01.006'),
('3.1.3.6.01.999'),
('3.1.3.7.01.001'),
('3.1.3.7.01.003'),
('3.1.3.7.01.004'),
('3.1.3.7.01.006'),
('3.1.3.7.01.007'),
('3.1.3.7.01.008'),
('3.1.3.7.01.009'),
('3.1.3.7.01.010'),
('3.1.3.7.01.011'),
('3.1.3.7.01.015'),
('3.1.3.7.01.021'),
('3.1.3.7.01.023'),
('3.1.3.8.01.001'),
('3.1.4.1.01.003'),
('3.1.4.1.02.001'),
('3.1.4.2.01.001'),
('3.1.4.2.01.004'),
('3.1.4.2.01.005'),
('3.1.4.2.01.007'),
('5.1.1.2.01.001'),
('5.2.2.2.01.001'),
('5.2.2.2.01.003'),
('5.2.2.2.01.006'),
('5.2.4.1.01.001'),
('5.2.5.2.01.001'),
('3.1.2.2.01.003'),
('3.1.3.1.02.010'),
('3.1.3.3.01.999'),
('3.1.3.5.01.001'),
('3.1.3.5.01.002'),
('3.1.3.7.01.999'),
('3.1.4.2.01.006'),
('3.1.2.1.02.006'),
('3.1.4.1.01.005'),
('3.1.3.7.01.005'),
('5.2.2.2.01.005'),
('5.2.2.2.01.004');

WITH DEB_CRED AS (
    SELECT A.DEBITO AS 'CONTA', A.IDLANCAMENTO, A.IDPARTIDA, A.LCTREF,
	CASE WHEN B.NATUREZA = '0' THEN A.VALOR * -1 ELSE A.VALOR END AS VALOR
    FROM CorporeRM.CLANCA A
    INNER JOIN CorporeRM.CCONTA B ON A.DEBITO = B.CODCONTA
    INNER JOIN @LISTA C ON A.DEBITO COLLATE SQL_Latin1_General_CP1_CI_AS = C.CONTA
    WHERE YEAR(A.DATA) = @ANO AND MONTH(A.DATA) = @MES AND A.CODHISTP <> '820'

UNION ALL 

SELECT A.CREDITO AS 'CONTA', A.IDLANCAMENTO, A.IDPARTIDA, A.LCTREF,
	CASE WHEN B.NATUREZA = '0' THEN A.VALOR ELSE A.VALOR * -1 END AS VALOR
    FROM CorporeRM.CLANCA A
    INNER JOIN CorporeRM.CCONTA B ON A.CREDITO = B.CODCONTA
    INNER JOIN @LISTA C ON A.CREDITO COLLATE SQL_Latin1_General_CP1_CI_AS = C.CONTA
    WHERE YEAR(A.DATA) = @ANO AND MONTH(A.DATA) = @MES AND A.CODHISTP <> '820')

SELECT CONTA, FORMAT(SUM(VALOR), 'C', 'PT-BR') AS VALOR FROM DEB_CRED
GROUP BY CONTA
ORDER BY CONTA ASC